<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
>
<head>
    <meta charset="UTF-8">
    <title>Chart</title>
</head>
<body>
<section th:fragment="Chart"
         class="grid grid-cols-1 xl:grid-cols-3 gap-6">
    <div class="xl:col-span-2">
        <div class="p-6 bg-white/80 dark:bg-slate-900/80 border border-slate-200/50 dark:border-slate-700/50 rounded-xl">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-slate-800 dark:text-white">
                        Biểu đồ doanh thu
                    </h3>
                    <p class="text-sm text-slate-500 dark:text-slate-300">
                        Doanh thu và chi phí hàng tháng
                    </p>
                </div>

                <div class="flex items-center space-x-3">
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-violet-600 to-orange-600"></div>
                        <span class="text-sm text-slate-500 dark:text-slate-300">Doanh thu</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full bg-gradient-to-r from-slate-400 to-slate-500"></div>
                        <span class="text-sm text-slate-500 dark:text-slate-300">Chi phí</span>
                    </div>
                </div>
            </div>

            <div class="h-80">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
    </div>

    <div class="space-y-6">
        <div class="p-6 bg-white/80 dark:bg-slate-900/80 border border-slate-200/50 dark:border-slate-700/50 rounded-xl">
            <div class="mb-6">
                <h3 class="text-xl font-bold text-slate-800 dark:text-white">
                    Biểu đồ bán hàng
                </h3>
                <p class="text-sm text-slate-500 dark:text-slate-300">
                    Top thể loại sách bán nhiều nhất
                </p>
            </div>
            <div class="h-48">
                <canvas id="salesChart"></canvas>
            </div>
            <div id="pieChart-legend" class="mt-6"></div>
        </div>
    </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const data = [
            { month: "Jan", revenue: 45000, expenses: 32000 },
            { month: "Feb", revenue: 52000, expenses: 34000 },
            { month: "Mar", revenue: 48000, expenses: 34000 },
            { month: "Apr", revenue: 61000, expenses: 23000 },
            { month: "May", revenue: 55000, expenses: 65000 },
            { month: "Jun", revenue: 67000, expenses: 12000 },
            { month: "Jul", revenue: 72000, expenses: 25000 },
            { month: "Aug", revenue: 69000, expenses: 44000 },
            { month: "Sep", revenue: 78000, expenses: 76000 },
            { month: "Oct", revenue: 74000, expenses: 34000 },
            { month: "Nov", revenue: 82000, expenses: 64000 },
            { month: "Dec", revenue: 41000, expenses: 56000 },
        ];

        const ctx = document.getElementById('revenueChart');
        if (!ctx) return;

        const isDarkMode = document.documentElement.classList.contains('dark');
        const gridColor = isDarkMode ? 'rgba(100, 116, 139, 0.3)' : 'rgba(226, 232, 240, 0.3)';
        const textColor = isDarkMode ? '#94a3b8' : '#64748b';

        function createGradient(ctx, colorStops) {
            const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, colorStops[0]);
            gradient.addColorStop(1, colorStops[1]);
            return gradient;
        }

        const revenueGradient = createGradient(ctx, ['#f97316', '#7c3aed']);
        const expensesGradient = createGradient(ctx, ['#64748b', '#f1f5f9']);

        const revenueChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.map(item => item.month),
                datasets: [
                    {
                        label: 'Thu',
                        data: data.map(item => item.revenue),
                        backgroundColor: revenueGradient,
                        borderRadius: 4,
                        barPercentage: 0.8,
                    },
                    {
                        label: 'Chi',
                        data: data.map(item => item.expenses),
                        backgroundColor: expensesGradient,
                        borderRadius: 4,
                        barPercentage: 0.8,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false,
                    },
                    tooltip: {
                        backgroundColor: isDarkMode ? 'rgba(15, 23, 42, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                        titleColor: isDarkMode ? '#f1f5f9' : '#1e293b',
                        bodyColor: isDarkMode ? '#cbd5e1' : '#475569',
                        borderColor: isDarkMode ? 'rgba(51, 65, 85, 0.5)' : 'rgba(226, 232, 240, 0.5)',
                        borderWidth: 1,
                        cornerRadius: 12,
                        boxPadding: 6,
                        usePointStyle: true,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    label += new Intl.NumberFormat('vi-VN', {
                                        style: 'currency',
                                        currency: 'VND'
                                    }).format(context.parsed.y);
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false,
                        },
                        ticks: {
                            color: textColor,
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        grid: {
                            color: gridColor,
                            drawBorder: false,
                        },
                        ticks: {
                            color: textColor,
                            font: {
                                size: 12
                            },
                            callback: function(value) {
                                return (value / 1000) + 'k';
                            }
                        }
                    }
                }
            }
        });

        const pieData = [
            { name: "Manga", value: 45, color: "#f97316" },
            { name: "Tin học", value: 30, color: "#7c3aed" },
            { name: "Tiểu thuyết", value: 15, color: "#10b981" },
            { name: "Khác", value: 10, color: "#8b5cf6" }
        ];

        const pieCtx = document.getElementById('salesChart');
        if (pieCtx) {
            const salesChart = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: pieData.map(item => item.name),
                    datasets: [{
                        data: pieData.map(item => item.value),
                        backgroundColor: pieData.map(item => item.color),
                        borderWidth: 0,
                        borderRadius: 4,
                        spacing: 5,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: isDarkMode ? 'rgba(15, 23, 42, 0.95)' : 'rgba(255, 255, 255, 0.95)',
                            titleColor: isDarkMode ? '#f1f5f9' : '#1e293b',
                            bodyColor: isDarkMode ? '#cbd5e1' : '#475569',
                            borderColor: isDarkMode ? 'rgba(51, 65, 85, 0.5)' : 'rgba(226, 232, 240, 0.5)',
                            borderWidth: 1,
                            cornerRadius: 12,
                            boxPadding: 6,
                            usePointStyle: true,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed}%`;
                                }
                            }
                        }
                    }
                }
            });
        }

        const legendContainer = document.createElement('div');
        legendContainer.className = 'space-y-3';
        legendContainer.innerHTML = pieData.map((item, index) => `
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-3 h-3 rounded-full" style="background-color: ${item.color}"></div>
                    <span class="text-sm text-slate-600 dark:text-slate-400">${item.name}</span>
                </div>
                <div class="text-sm font-semibold text-slate-800 dark:text-white">${item.value}%</div>
            </div>
        `).join('');

        const pie = document.getElementById("pieChart-legend");
        pie.appendChild(legendContainer);
    });
</script>
</body>
</html>